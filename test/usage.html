

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Generic usage &mdash; esgprep 3.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=9edc463e" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=acc74ff5"></script>
      <script src="_static/doctools.js?v=fd6eb6e6"></script>
      <script src="_static/sphinx_highlight.js?v=6ffebe34"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Manage local data through the DRS" href="drs.html" />
    <link rel="prev" title="Configuration" href="configuration.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            esgprep
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="concepts.html">Concepts &amp; Terminology</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuration</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Generic usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#check-the-help">Check the help</a></li>
<li class="toctree-l2"><a class="reference internal" href="#check-the-version">Check the version</a></li>
<li class="toctree-l2"><a class="reference internal" href="#debug-mode">Debug mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="#specify-the-project">Specify the project</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configuration-management">Configuration management</a></li>
<li class="toctree-l2"><a class="reference internal" href="#use-a-logfile">Use a logfile</a></li>
<li class="toctree-l2"><a class="reference internal" href="#use-filters">Use filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="#use-multiprocessing">Use multiprocessing</a></li>
<li class="toctree-l2"><a class="reference internal" href="#toggle-color-prompt">Toggle color prompt</a></li>
<li class="toctree-l2"><a class="reference internal" href="#exit-status">Exit status</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="drs.html">Manage local data through the DRS</a></li>
<li class="toctree-l1"><a class="reference internal" href="mapfiles.html">Generate mapfile for ESGF publication</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Real-World Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="migration.html">Migration Guide from esgprep 2.x to 3.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="credits.html">Credits</a></li>
<li class="toctree-l1"><a class="reference internal" href="log.html">Change Log</a></li>
<li class="toctree-l1"><a class="reference internal" href="autodoc.html">Code documentation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">esgprep</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Generic usage</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/usage.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="generic-usage">
<span id="usage"></span><h1>Generic usage<a class="headerlink" href="#generic-usage" title="Link to this heading"></a></h1>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p><strong>REQUIRED FIRST STEP:</strong> Before using any <code class="docutils literal notranslate"><span class="pre">esgdrs</span></code> or <code class="docutils literal notranslate"><span class="pre">esgmapfile</span></code> commands, you must install the controlled vocabularies:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>esgvoc<span class="w"> </span>install
<span class="c1"># OR if using uv:</span>
uv<span class="w"> </span>run<span class="w"> </span>esgvoc<span class="w"> </span>install
</pre></div>
</div>
<p>Without this step, all commands will fail with: <code class="docutils literal notranslate"><span class="pre">RuntimeError:</span> <span class="pre">universe</span> <span class="pre">connection</span> <span class="pre">is</span> <span class="pre">not</span> <span class="pre">initialized</span></code></p>
<p><strong>Keep vocabularies updated:</strong> Run <code class="docutils literal notranslate"><span class="pre">esgvoc</span> <span class="pre">install</span></code> regularly to update your local controlled vocabularies
with the latest changes from ESGF projects. Outdated vocabularies may cause validation failures.</p>
<p>See <a class="reference internal" href="installation.html#installation"><span class="std std-ref">Installation</span></a> for more details, or visit the
<a class="reference external" href="https://esgf.github.io/esgf-vocab/index.html">esgvoc documentation</a> for advanced vocabulary management.</p>
</div>
<dl class="simple">
<dt>All the following arguments can be safely combined and add to each of the esgprep <strong>COMMAND</strong>:</dt><dd><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">esgdrs</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">esgmapfile</span></code></p></li>
</ul>
</dd>
</dl>
<section id="check-the-help">
<h2>Check the help<a class="headerlink" href="#check-the-help" title="Link to this heading"></a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$&gt;<span class="w"> </span>COMMAND<span class="w"> </span><span class="o">[</span>SUBCOMMAND<span class="o">]</span><span class="w"> </span><span class="o">{</span>-h,--help<span class="o">}</span>
</pre></div>
</div>
</section>
<section id="check-the-version">
<h2>Check the version<a class="headerlink" href="#check-the-version" title="Link to this heading"></a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$&gt;<span class="w"> </span>COMMAND<span class="w"> </span><span class="o">{</span>-v,--version<span class="o">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The program version will be the same for all the esgprep tools.</p>
</div>
</section>
<section id="debug-mode">
<h2>Debug mode<a class="headerlink" href="#debug-mode" title="Link to this heading"></a></h2>
<p>Some progress bars informs you about the processing status of the different subcommands. You can switch to a more
verbose mode displaying each step with useful additional information.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$&gt;<span class="w"> </span>COMMAND<span class="w"> </span><span class="o">[</span>SUBCOMMAND<span class="o">]</span><span class="w"> </span><span class="o">{</span>-d,--debug<span class="o">}</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This debug/verbose mode is silently activated in the case of a logfile (i.e., no progress bars).</p>
</div>
</section>
<section id="specify-the-project">
<h2>Specify the project<a class="headerlink" href="#specify-the-project" title="Link to this heading"></a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">--project</span></code> argument is used to parse the corresponding project configuration. It is <strong>always required</strong>.
This argument is case-sensitive and has to correspond to a valid project name in the esgvoc controlled vocabularies.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$&gt;<span class="w"> </span>COMMAND<span class="w"> </span><span class="o">[</span>SUBCOMMAND<span class="o">]</span><span class="w"> </span><span class="o">{</span>-p,--project<span class="o">}</span><span class="w"> </span>PROJECT_ID
</pre></div>
</div>
</section>
<section id="configuration-management">
<h2>Configuration management<a class="headerlink" href="#configuration-management" title="Link to this heading"></a></h2>
<p>Configuration and controlled vocabularies are now managed by the <code class="docutils literal notranslate"><span class="pre">esgvoc</span></code> library. The <code class="docutils literal notranslate"><span class="pre">esgvoc</span></code> library
automatically handles vocabulary fetching and caching. By default, vocabularies are cached locally to avoid
repeated downloads.</p>
<p>For more information on <code class="docutils literal notranslate"><span class="pre">esgvoc</span></code> configuration, see the <a class="reference internal" href="configuration.html#configuration"><span class="std std-ref">Configuration</span></a> section.</p>
<p>For detailed information about controlled vocabularies management and the <code class="docutils literal notranslate"><span class="pre">esgvoc</span></code> library, see the
<a class="reference external" href="https://esgf.github.io/esgf-vocab/index.html">esgvoc documentation</a>.</p>
</section>
<section id="use-a-logfile">
<h2>Use a logfile<a class="headerlink" href="#use-a-logfile" title="Link to this heading"></a></h2>
<p>Outputs can be logged into a file named <code class="docutils literal notranslate"><span class="pre">PROG-YYYYMMDD-HHMMSS-PID.log</span></code>. If not, the standard output is used following the verbose mode.
By default, the logfiles are stored in a <code class="docutils literal notranslate"><span class="pre">logs</span></code> folder created in your current working directory (if not exists).
It can be changed by adding a optional logfile directory to the flag.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$&gt;<span class="w"> </span>COMMAND<span class="w"> </span><span class="o">[</span>SUBCOMMAND<span class="o">]</span><span class="w"> </span>-l<span class="w"> </span><span class="o">[</span>/PATH/TO/LOGDIR/<span class="o">]</span>
</pre></div>
</div>
</section>
<section id="use-filters">
<h2>Use filters<a class="headerlink" href="#use-filters" title="Link to this heading"></a></h2>
<p><code class="docutils literal notranslate"><span class="pre">esgdrs</span></code> and <code class="docutils literal notranslate"><span class="pre">esgmapfile</span></code> commands will scan your local archive to achieve proper data
management. In such a scan, you can filter the file discovery by using a Python regular expression
(see <a class="reference external" href="https://docs.python.org/3/library/re.html">re</a> Python library).</p>
<p>The default is to walk through your local filesystem ignoring the <code class="docutils literal notranslate"><span class="pre">files</span></code> and <code class="docutils literal notranslate"><span class="pre">latest</span></code> version levels
and any hidden folders by using the following regular expression: <code class="docutils literal notranslate"><span class="pre">^.*/(files|latest|\.[\w]*).*$</span></code>. It can be change
with:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$&gt;<span class="w"> </span>COMMAND<span class="w"> </span><span class="o">[</span>SUBCOMMAND<span class="o">]</span><span class="w"> </span>--ignore-dir<span class="w"> </span>PYTHON_REGEX
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">esgprep</span></code> only considers unhidden NetCDF files by default excuding the regular expression <code class="docutils literal notranslate"><span class="pre">^\..*$</span></code> and
including the following one <code class="docutils literal notranslate"><span class="pre">.*\.nc$</span></code>. It can be independently change with:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$&gt;<span class="w"> </span>COMMAND<span class="w"> </span><span class="o">[</span>SUBCOMMAND<span class="o">]</span><span class="w"> </span>--include-file<span class="w"> </span>PYTHON_REGEX<span class="w"> </span>--exclude-file<span class="w"> </span>PYTHON_REGEX
</pre></div>
</div>
<p>Keep in mind that <code class="docutils literal notranslate"><span class="pre">--ignore-dir</span></code> and <code class="docutils literal notranslate"><span class="pre">--exclude-file</span></code> specifie a directory pattern <strong>NOT</strong> to be matched, while
<code class="docutils literal notranslate"><span class="pre">--include-file</span></code> specifies a filename pattern <strong>TO BE</strong> matched.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><code class="docutils literal notranslate"><span class="pre">esgdrs</span></code> only works with unhidden NetCDF files.</p>
</div>
</section>
<section id="use-multiprocessing">
<h2>Use multiprocessing<a class="headerlink" href="#use-multiprocessing" title="Link to this heading"></a></h2>
<p><code class="docutils literal notranslate"><span class="pre">esgprep</span></code> uses a multiprocessing. This is useful to process a large amount of data, especially in the case
of <code class="docutils literal notranslate"><span class="pre">drs</span></code> and <code class="docutils literal notranslate"><span class="pre">mapfile</span></code> subcommands with file checksum computation. Set the number of maximal processes to
simultaneously treat several files. One process seems sequential processing. Set it to -1 to use all available
CPU processes (as returned by <code class="docutils literal notranslate"><span class="pre">multiprocessing.cpu_count()</span></code>). Default is set to 4 processes.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$&gt;<span class="w"> </span>COMMAND<span class="w"> </span><span class="o">[</span>SUBCOMMAND<span class="o">]</span><span class="w"> </span>--max-processes<span class="w"> </span>INTEGER
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The number of maximal processes is limited to the maximum CPU count in any case.</p>
</div>
</section>
<section id="toggle-color-prompt">
<h2>Toggle color prompt<a class="headerlink" href="#toggle-color-prompt" title="Link to this heading"></a></h2>
<p><code class="docutils literal notranslate"><span class="pre">esgprep</span></code> commands prompot you different results in a color fashion to emphasise useful information.
Those colors can lead to undesired characters into the logs or machine-readable processes. Default is to
enable colors when priting to a terminal. You can switch on/off colors print by using:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$&gt;<span class="w"> </span>COMMAND<span class="w"> </span><span class="o">[</span>SUBCOMMAND<span class="o">]</span><span class="w"> </span><span class="o">{</span>--color,<span class="w"> </span>--no-color<span class="o">}</span>
</pre></div>
</div>
</section>
<section id="exit-status">
<h2>Exit status<a class="headerlink" href="#exit-status" title="Link to this heading"></a></h2>
<blockquote>
<div><ul class="simple">
<li><dl class="simple">
<dt>Status = -1</dt><dd><p>Argument parsing error.</p>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="configuration.html" class="btn btn-neutral float-left" title="Configuration" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="drs.html" class="btn btn-neutral float-right" title="Manage local data through the DRS" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Troussellier, Laurent.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>