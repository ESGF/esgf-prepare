

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Generation mapfiles for ESGF publication &mdash; esgprep 2.7.6 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="esgprep 2.7.6 documentation" href="index.html"/>
        <link rel="next" title="Frequently asked questions" href="faq.html"/>
        <link rel="prev" title="Check CV against configuration INI files" href="check-vocab.html"/> 

  
  <script src="static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> esgprep
          

          
          </a>

          
            
            
              <div class="version">
                2.7
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Generic usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="fetch-ini.html">Fetch ESGF configuration INI files</a></li>
<li class="toctree-l1"><a class="reference internal" href="drs.html">Manage local data through the DRS</a></li>
<li class="toctree-l1"><a class="reference internal" href="check-vocab.html">Check CV against configuration INI files</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Generation mapfiles for ESGF publication</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#default-mapfile-generation">Default mapfile generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#mapfile-without-files-checksums">Mapfile without files checksums</a></li>
<li class="toctree-l2"><a class="reference internal" href="#mapfile-without-drs-versions">Mapfile without DRS versions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#mapfile-name-using-tokens">Mapfile name using tokens</a></li>
<li class="toctree-l2"><a class="reference internal" href="#organize-your-mapfiles">Organize your mapfiles</a></li>
<li class="toctree-l2"><a class="reference internal" href="#walking-through-latest-directories-only">Walking through <em>latest</em> directories only</a></li>
<li class="toctree-l2"><a class="reference internal" href="#walking-through-a-particular-version-only">Walking through a particular version only</a></li>
<li class="toctree-l2"><a class="reference internal" href="#walking-through-all-versions">Walking through all versions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#add-technical-notes">Add technical notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="#overwrite-the-dataset-identifier">Overwrite the dataset identifier</a></li>
<li class="toctree-l2"><a class="reference internal" href="#enforce-facet-checking">Enforce facet checking</a></li>
<li class="toctree-l2"><a class="reference internal" href="#exit-status">Exit status</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">Frequently asked questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="credits.html">Credits</a></li>
<li class="toctree-l1"><a class="reference internal" href="log.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="autodoc.html">Code documentation</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">esgprep</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Generation mapfiles for ESGF publication</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="sources/mapfiles.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="generation-mapfiles-for-esgf-publication">
<span id="mapfiles"></span><h1>Generation mapfiles for ESGF publication<a class="headerlink" href="#generation-mapfiles-for-esgf-publication" title="Permalink to this headline">¶</a></h1>
<p>The publication process on the ESGF nodes requires <em>mapfiles</em>. Mapfiles are text files where each line
describes a file to publish, using the following format:</p>
<p><code class="docutils literal"><span class="pre">dataset_ID</span> <span class="pre">|</span> <span class="pre">absolute_path</span> <span class="pre">|</span> <span class="pre">size_bytes</span> <span class="pre">[</span> <span class="pre">|</span> <span class="pre">option=value</span> <span class="pre">]</span></code></p>
<blockquote>
<div><ol class="arabic simple">
<li>All values have to be pipe-separated.</li>
<li>The dataset identifier, the absolute path and the size (in bytes) are required.</li>
<li>Adding the version number to the dataset identifier is strongly recommended to publish in a in bulk.</li>
<li>Strongly recommended optional values are:</li>
</ol>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">mod_time</span></code>: last modification date of the file (since Unix EPOCH time, i.e., seconds since January, 1st, 1970),</li>
<li><code class="docutils literal"><span class="pre">checksum</span></code>: file checksum,</li>
<li><code class="docutils literal"><span class="pre">checksum_type</span></code>: checksum type (MD5 or the default SHA256).</li>
</ul>
</div></blockquote>
<ol class="arabic simple" start="5">
<li>Your directory structure has to strictly follows the tree fixed by the DRS including the version facet.</li>
<li>To store ONE mapfile PER dataset is strongly recommended.</li>
</ol>
</div></blockquote>
<p><code class="docutils literal"><span class="pre">esgprep</span> <span class="pre">mapfile</span></code> is a flexible command-line allowing you to easily generate mapfiles</p>
<div class="section" id="default-mapfile-generation">
<h2>Default mapfile generation<a class="headerlink" href="#default-mapfile-generation" title="Permalink to this headline">¶</a></h2>
<p>The default behavior is to pick up the latest version in the DRS. This required version with a date format
(e.g., v20151023). If the version is directly specified in positional argument, the version number from supplied
directory is used.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$&gt; esgprep mapfile --project PROJECT_ID /PATH/TO/SCAN/
</pre></div>
</div>
</div>
<div class="section" id="mapfile-without-files-checksums">
<h2>Mapfile without files checksums<a class="headerlink" href="#mapfile-without-files-checksums" title="Permalink to this headline">¶</a></h2>
<p>Because this could be time consuming <code class="docutils literal"><span class="pre">--no-checksum</span></code> allows you not include the file checksum into your mapfile(s).</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$&gt; esgprep mapfile --project PROJECT_ID /PATH/TO/SCAN/ --no-checksum
</pre></div>
</div>
</div>
<div class="section" id="mapfile-without-drs-versions">
<h2>Mapfile without DRS versions<a class="headerlink" href="#mapfile-without-drs-versions" title="Permalink to this headline">¶</a></h2>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$&gt; esgprep mapfile --project PROJECT_ID /PATH/TO/SCAN/ --no-version
</pre></div>
</div>
</div>
<div class="section" id="mapfile-name-using-tokens">
<h2>Mapfile name using tokens<a class="headerlink" href="#mapfile-name-using-tokens" title="Permalink to this headline">¶</a></h2>
<p>The mapfile name is composed by the dataset ID and the dataset version dot-separated. Another template
can be specified for the output mapfile(s) name using several tokens. Substrings <code class="docutils literal"><span class="pre">{dataset_id}</span></code>, <code class="docutils literal"><span class="pre">{version}</span></code>,
<code class="docutils literal"><span class="pre">{job_id}</span></code> or <code class="docutils literal"><span class="pre">{date}</span></code> (in YYYYDDMM) will be substituted where found. If <code class="docutils literal"><span class="pre">{dataset_id}</span></code> is not present in mapfile
name, then all datasets will be written to a single mapfile, overriding the default behavior of producing ONE mapfile
PER dataset.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$&gt; esgprep mapfile --project PROJECT_ID /PATH/TO/SCAN/ --mapfile <span class="o">{</span>dataset_id<span class="o">}</span>.<span class="o">{</span>job_id<span class="o">}</span>
$&gt; esgprep mapfile --project PROJECT_ID /PATH/TO/SCAN/ --mapfile <span class="o">{</span>date<span class="o">}</span>.<span class="o">{</span>job_id<span class="o">}</span>
$&gt; esgprep mapfile --project PROJECT_ID /PATH/TO/SCAN/ --mapfile MY_MAPFILE.<span class="o">{</span>version<span class="o">}</span>.<span class="o">{</span>date<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="organize-your-mapfiles">
<h2>Organize your mapfiles<a class="headerlink" href="#organize-your-mapfiles" title="Permalink to this headline">¶</a></h2>
<p>The mapfile(s)are generated into a <code class="docutils literal"><span class="pre">mapfile</span></code> folder created in your working directory (if exists). This can be
changed by submitting an output directory for your mapfiles.</p>
<p>In addition, a <code class="docutils literal"><span class="pre">mapfile_drs</span></code> attribute can be added into the corresponding project section of the configuration INI
file(s) (see <a class="reference internal" href="configuration.html#configuration"><span class="std std-ref">Configuration</span></a>). In the same way as the <code class="docutils literal"><span class="pre">directory_format</span></code> it defines a tree depending on the
facets. Each mapfile is then written into the corresponding output directory. This <code class="docutils literal"><span class="pre">mapfile_drs</span></code> directory structure
will be added to the output directory if submitted.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$&gt; esgprep mapfile --project PROJECT_ID /PATH/TO/SCAN/ --outdir /PATH/TO/MY_MAPFILES/
</pre></div>
</div>
<p>The output directory is cleaned up prior to mapfile process to avoid uncomplete mapfiles. In the case of several
<code class="docutils literal"><span class="pre">esgprep</span> <span class="pre">mapfile</span></code> instances run with the same output directory it is recommended to disable the cleanup:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$&gt; esgprep mapfile --project PROJECT_ID /PATH/TO/SCAN/ --no-cleanup
</pre></div>
</div>
</div>
<div class="section" id="walking-through-latest-directories-only">
<h2>Walking through <em>latest</em> directories only<a class="headerlink" href="#walking-through-latest-directories-only" title="Permalink to this headline">¶</a></h2>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$&gt; esgprep mapfile --project PROJECT_ID /PATH/TO/SCAN/ --latest-symlink
</pre></div>
</div>
</div>
<div class="section" id="walking-through-a-particular-version-only">
<h2>Walking through a particular version only<a class="headerlink" href="#walking-through-a-particular-version-only" title="Permalink to this headline">¶</a></h2>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$&gt; esgprep mapfile --project PROJECT_ID /PATH/TO/SCAN/ --version VERSION
</pre></div>
</div>
</div>
<div class="section" id="walking-through-all-versions">
<h2>Walking through all versions<a class="headerlink" href="#walking-through-all-versions" title="Permalink to this headline">¶</a></h2>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$&gt; esgprep mapfile --project PROJECT_ID /PATH/TO/SCAN/ --all-versions
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This disables <code class="docutils literal"><span class="pre">--no-version</span></code>.</p>
</div>
</div>
<div class="section" id="add-technical-notes">
<h2>Add technical notes<a class="headerlink" href="#add-technical-notes" title="Permalink to this headline">¶</a></h2>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$&gt; esgprep mapfile --project PROJECT_ID /PATH/TO/SCAN/ --tech-notes-url URL --tech-notes-title TITLE
</pre></div>
</div>
</div>
<div class="section" id="overwrite-the-dataset-identifier">
<h2>Overwrite the dataset identifier<a class="headerlink" href="#overwrite-the-dataset-identifier" title="Permalink to this headline">¶</a></h2>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$&gt; esgprep mapfile --project PROJECT_ID /PATH/TO/SCAN/ --dataset DATASET_NAME
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">All files will belong to the specified dataset, regardless of the DRS.</p>
</div>
</div>
<div class="section" id="enforce-facet-checking">
<h2>Enforce facet checking<a class="headerlink" href="#enforce-facet-checking" title="Permalink to this headline">¶</a></h2>
<p>The following facets are always ignored during facet checking:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">root</span></code></li>
<li><code class="docutils literal"><span class="pre">project</span></code></li>
<li><code class="docutils literal"><span class="pre">filename</span></code></li>
<li><code class="docutils literal"><span class="pre">variable</span></code></li>
<li><code class="docutils literal"><span class="pre">version</span></code></li>
<li><code class="docutils literal"><span class="pre">period_start</span></code></li>
<li><code class="docutils literal"><span class="pre">period_end</span></code>.</li>
</ul>
</div></blockquote>
<p>Indeed those facets are historically not a part of the configuration INI file(s). All allowed values are so not
enumerated through very long list(s). Nevertheless one or more of those facet(s) should be resolved against the
configuration file(s), this could be useful in case of differences between <code class="docutils literal"><span class="pre">directory_format</span></code> and <code class="docutils literal"><span class="pre">dataset_id</span></code>
patterns.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$&gt; esgprep mapfile --project PROJECT_ID /PATH/TO/SCAN/ --not-ignored FACEY_KEY
$&gt; esgprep mapfile --project PROJECT_ID /PATH/TO/SCAN/ --not-ignored FACEY_KEY1 FACET_KEY2
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For instance, the <code class="docutils literal"><span class="pre">var</span></code> facet in obs4MIPs <code class="docutils literal"><span class="pre">dataset_id</span></code> pattern must be deduced from
the <code class="docutils literal"><span class="pre">directory_format</span></code> using the <code class="docutils literal"><span class="pre">variable</span></code> facet. Consequently, you can use <code class="docutils literal"><span class="pre">--not-ignored</span> <span class="pre">variable</span></code> to
resolve this facet from the appropriate maptable.</p>
</div>
</div>
<div class="section" id="exit-status">
<h2>Exit status<a class="headerlink" href="#exit-status" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><ul class="simple">
<li><dl class="first docutils">
<dt>Status = 0</dt>
<dd>All the files have been successfully scanned and the mapfile(s) properly generated.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Status = 1</dt>
<dd>No files found. No mapfile(s) generated.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Status = 2</dt>
<dd>Some scan errors occured. Some files have been skipped or failed during the scan potentially leading to incomplete
mapfiles. See the error logfile.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Status = 3</dt>
<dd>All the files have been skipped or failed during the scan leading to no mapfile(s). See the error logfile.</dd>
</dl>
</li>
</ul>
</div></blockquote>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="faq.html" class="btn btn-neutral float-right" title="Frequently asked questions" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="check-vocab.html" class="btn btn-neutral" title="Check CV against configuration INI files" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Levavasseur, G..

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'2.7.6',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="static/jquery.js"></script>
      <script type="text/javascript" src="static/underscore.js"></script>
      <script type="text/javascript" src="static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>